/*! minefiled  
 * Copyright 2016-2016 sevdog
 *
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 * 
 * The above copyright notice and this permission notice shall be included in all
 * copies or substantial portions of the Software. * 
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
 * SOFTWARE.. 
 */
!function(a,b){b["minefiled "]=a;var c={version:"version",mines:"Mines"},d={version:"versione",mines:"Mine"};!function(a){function b(a,b){a.translations("it",d).translations("en",c).determinePreferredLanguage().fallbackLanguage("en"),b.setStorageType("localStorage").setPrefix("minefield")}a.module("minefield",["ngAnimate","ngTouch","ngAria","pascalprecht.translate","LocalStorageModule"]),a.module("minefield").config(["$translateProvider","localStorageServiceProvider",b]),a.module("minefield").constant("version","0.1.0"),a.module("minefield").constant("crYearFrom","2016"),a.module("minefield").constant("crYearTo",""),a.module("minefield").constant("crOwner","sevdog"),a.module("minefield").constant("rows",10),a.module("minefield").constant("columns",10)}(angular),function(a){function b(){return{restrict:"E",scope:{row:"=",col:"=",info:"="},link:c,controllerAs:"cell",bindToController:!0,controller:["$timeout","cellManager",d],template:'<div class="cell-flipper"><button type="button" class="btn btn-warning cell-front" ng-click="cell.show()" ng-right-click="cell.flag()"><i class="fa fa-flag" ng-show="cell.info.flagged"></i></button><div class="btn cell-back" ng-class="{\'btn-danger\': cell.info.isMine && cell.info.exploded ,\'btn-success\': cell.info.flagged && cell.info.isMine}"><i ng-if="cell.info.isMine" class="fa fa-bomb"></i><i ng-if="!cell.info.isMine && cell.info.value == 0"></i><i ng-if="!cell.info.isMine && cell.info.value != 0" ng-class="\'cell-help-\' + cell.info.value">{{:: cell.info.value }}</i></div></div>'}}function c(a,b){a.$watch("cell.info.shown",function(a,c){a&&b.addClass("shown").find("button").attr("tabindex","-1")}),a.$watch("cell.info.exploding",function(a,c){a?b.addClass("exploding"):b.removeClass("exploding")})}function d(a,b){function c(){b.shared.lost||b.shared.win||f.flagged||(f.shown=!0,f.isMine||0!=f.value||b.propagateShow(e.row,e.col),f.isMine&&(b.shared.lost=!0,a(function(){f.exploding=!0,a(function(){f.exploding=!1,f.exploded=!0,b.showAll()},1e3)},600)))}function d(){b.shared.lost||b.shared.win||(f.flagged=!f.flagged)}var e=this,f=e.info;e.show=c,e.flag=d}a.module("minefield").directive("cell",b)}(angular),function(a){function b(){return{restrict:"E",scope:{},controllerAs:"cpr",controller:["version","crYearTo","crYearFrom","crOwner",c],template:'<footer class="text-right text-muted"><h5>{{:: \'version\' | translate }} {{:: cpr.version }}</h5><i class="fa fa-copyright"></i> {{:: cpr.year }} {{ cpr.owner }}</footer>'}}function c(a,b,c,d){var e=this;e.version=a,e.year=c+(b?"-"+b:""),e.owner=d}angular.module("minefield").directive("copyRight",b)}(angular),function(a){function b(){return{restrict:"E",scope:{},controllerAs:"field",controller:["$scope","cellManager",c],template:'<div class="field-row" ng-repeat="row in field.rows" ng-init="rowIdx = $index"><cell ng-repeat="cell in row" col="$index" row="rowIdx" info="cell"></cell></div>'}}function c(a,b){var c=this;c.rows=b.createField(),c.info=b.shared,a.$watch("field.info.reload",function(a,d){a&&(c.rows=b.createField(),b.shared.reload=!1)})}a.module("minefield").directive("field",b)}(angular),function(a){function b(){return{restrict:"E",controllerAs:"stg",controller:["$scope","cellManager",c],template:'<div class="row"><div class="col-xs-12"><label class="control-label">{{:: "mines" | translate }}</label> <input class="form-control" type="number" ng-model="stg.values.mines" min="1" max="99" step="1"> <button type="button" class="btn btn-primary" ng-click="stg.play()"><i class="fa fa-refresh"></i></button></div></div>'}}function c(a,b){function c(){b.reload()}var d=this;d.values=b.shared,d.play=c}a.module("minefield").directive("settings",b)}(angular),function(a){function b(a){for(var b,c,d=a.length;d>0;)c=Math.floor(Math.random()*d),--d,b=a[d],a[d]=a[c],a[c]=b;return a}function c(a,c){function d(){for(var d=[],e=a*c,f=0;e>f;++f)d[d.length]=f<this.shared.mines?9:0;d=b(d);for(var g=d.reduce(function(a,b,d){var e=a.length;return d%c==0?a[e]=[]:--e,a[e][a[e].length]={value:b,shown:!1,flagged:!1},a},[]),h=0;a>h;++h)for(var i=0;c>i;++i)if(g[h][i].value>=9){g[h][i].isMine=!0;for(var j=0==h?h:h-1;h+1>=j&&a>j;++j)for(var k=0==i?i:i-1;i+1>=k&&c>k;++k)++g[j][k].value}return this.field=g,g}function e(b,d){for(var e=this,f=0==b?b:b-1;b+1>=f&&a>f;++f)for(var g=0==d?d:d-1;d+1>=g&&c>g;++g){var h=e.field[f][g];h.isMine||h.shown||h.flagged||(h.shown=!0,0==h.value&&e.propagateShow(f,g))}}function f(){for(var b=this,d=0;a>d;++d)for(var e=0;c>e;++e)b.field[d][e].shown=!0}function g(){var a=this,b=a.shared;b.win=!1,b.lost=!1,b.reload=!0}return{field:[],createField:d,propagateShow:e,showAll:f,reload:g,shared:{mines:10,reload:!1,lost:!1,win:!1}}}a.module("minefield").factory("cellManager",["rows","columns",c])}(angular),function(a){function b(a){return function(b,c,d){var e=a(d.ngRightClick);c.bind("contextmenu",function(a){b.$apply(function(){a.preventDefault(),e(b,{$event:a})})})}}a.module("minefield").directive("ngRightClick",["$parse",b])}(angular)}({},function(){return this}());